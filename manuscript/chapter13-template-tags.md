# Теги шаблонов

## Выдаем список категорий на каждой странице

Хотелось бы иметь возможность показывать различные категории, которые пользователь может просматривать в боковой панели на каждой странице. С учетом того, что мы изучили, можно было бы поступить следующим образом:

-   В шаблоне `base.html` добавить код, отображающий список категорий, если он был передан ему.
-   Затем в каждом представлении мы могли обращаться к объекту Category, получать все категории и передавать их в словарь контекста.

Но это довольно примитивное решение. Оно требует большого числа операций вырезания и вставки кода. Кроме того, возникнет проблема с отображением категорий на страницах, обслуживаемых пакетом django-registration-redux. Из-за этого необходим другой подход, использующий `теги шаблонов`, которые добавляются в шаблон и запрашивают необходимые данные.

### Использование тегов шаблонов

Создайте каталог `rango/templatetags`, , а в нем два файла - один назовите `__init__.py`, и оставьте его пустым, а второй -- `rango_extras.py`, в который добавьте следующий код:

{lang="python",linenos=off}
	from django import template
	from rango.models import Category

	register = template.Library()

	@register.inclusion_tag('rango/cats.html')
	def get_category_list():
    	return {'cats': Category.objects.all()}

Как видите, мы создали метод под названием `get_category_list()`, который возвращает список категорий, и связали его с шаблоном `rango/cats.html`. Теперь создайте шаблон `rango/cats.html` в каталоге с шаблонами и вставьте в него следующий код:

{lang="html",linenos=off}
	<ul class="nav nav-sidebar">
	{% if cats %}
		{% for c in cats %}             
			<li><a href="{% url 'category'  c.slug %}">{{ c.name }}</a></li>
		{% endfor %}      
	{% else %}
		<li> <strong >There are no category present.</strong></li>	
	{% endif %}  
	</ul> 
	
Теперь в Вашем базовом шаблоне `base.html` Вы можете обратиться к созданному тегу шаблона, сначала загрузив его с помощью команды `{% load rango\_extras %}`, а затем разместив его на странице в виде `{% get\_category\_list %}`, т. е.:  

{lang="html",linenos=off}      
	<div class="col-sm-3 col-md-2 sidebar">          
		{% block side_block %}         
		{% get_category_list %}         
		{% endblock %}      
	</div>   
	

I> Перезагрузите сервер, чтобы зарегистрировать новые теги
I>
I> Вам нужно будет перезапускать Ваш сервер каждый раз при модификации тегов шаблонов. В противном случае они не будут зарегистрированы в системе и Вы будете искать причину почему Ваш код не работает.

### Теги шаблонов с параметрами

Теперь давайте расширим функциональные возможности нашего тега так, чтобы при переходе на страницу с категорией, он подсвечивал категорию, в которой мы находимся в данный момент. Для этого необходимо передать аргументы в тег шаблона. Поэтому  отредактируйте метод в файле `rango\_extras.py` следующим образом:

{lang="python",linenos=off}
       def get_category_list(cat=None):         
	   return {'cats': Category.objects.all(), 'act_cat': cat}  

Это позволит передать методу категорию, в которой мы находимся в данной момент. Теперь можно изменить шаблон `base.html`, передавая в тег категорию, если она существует. 

{lang="html",linenos=off}

	<div class="col-sm-3 col-md-2 sidebar">          
	{% block side_block %}         
	{% get_category_list category %}         
	{% endblock %}      
	</div>   
	
Обновите шаблон `cats.html`:   

{lang="html",linenos=off}
	{% for c in cats %}
		{% if c == act_cat %} 
			<li  class="active" > 
		{% else  %} 
			 <li>
		{% endif %}
			<a href="{% url 'category'  c.slug %}">{{ c.name }}</a></li>
	{% endfor %}

В нём мы проверяем совпадает ли категория, выводимая на экран, с категорией (т. е. `act\_cat`), которая была передана методу; если да, то мы присваиваем ей Bootstrap класс `active` (http://getbootstrap.com/components/#nav). Перезапустите сервер для разработки и посетите различные страницы приложения. При каждом посещении страницы мы пытаемся получить доступ к переменной `category`. Когда Вы просматриваете страницу категории, шаблон имеет доступ к переменной `category`, значение которой передает тегу шаблона `get\_category\_list()`. Оно затем используется в шаблоне  `cats.html` для выделения активной категории.
