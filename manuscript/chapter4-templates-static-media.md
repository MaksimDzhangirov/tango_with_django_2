# Шаблоны и медиа файлы {#chapter-templates-static}
В этой главе мы начнём введение в механизм шаблонов Django, а также покажем как работать со *статическими* и *медиа* файлами. Вместо того, чтобы создавать каждую страницу с нуля, мы будем использовать шаблоны, создавая базовую структуру страницы, а в представлении будем передавать шаблону необходимые данные для отображения этой страницы. Для добавления javascript и css, а также изображений и другого мультимедийного контента, мы будем использовать механизм, предоставляемый Django, отвечающий за добавление и диспетчирезацию таких файлов, позволющих расширить функциональные возможности страницы (в случае javascript) или стилизировать наши страницы.

## Использование шаблонов
до сих пор мы только сопоставляли URL-адрес представлению. Но Django фреймворк основан на архитектуре *Модель-представление-Шаблон*. В этом разделе, мы рассмотрим как *Шаблоны* работают с представлениями *Views*, а в нескольких следующих главах объединим их с *Моделями*.

Почему стоит использовать шаблоны? Структура страницы внутри одного и того же сайта при переходе от одной страницы к другой часто совпадает. [Повторение макета страницы](http://www.techrepublic.com/blog/web-designer/effective-design-principles-for-web-designers-repetition/) - одинаковый хедер или футер на страницах веб сайта -  помогает пользователям при навигации, способствует организации веб сайта и усиливает чувство приемственности. [Django использует шаблоны](https://docs.djangoproject.com/en/1.2/ref/templates/), чтобы облегчить достижение этой дизайнерской цели разработчикам, а также для разделения логики приложения (кода внутри представлений) от его внешнего вида (того как выглядит и воспринимается Ваше приложение). В этой главе Вы создадите базовый шаблон, который будет использоваться для создания HTML страницы. Этот шаблон будет передаваться через Django представление. В [главе, касающейся баз данных и моделей](#chapter-models), мы пойдем ещё дальше и будем использовать шаблоны вместе с моделями для передачи динамически генерируемых данных.

> ### Резюме: Что же такое Шаблон?
> В Django, представляйте *шаблон* в виде строительных лесов, необходимых для создания полноценной HTML страницы. Шаблон состоит из *статических частей* страницы (то есть, частей, которые не меняются), а также специального синтаксиса (или *тегов шаблона*), которые могут быть переопределены и заменены *динамическим содержимым* Вашими Django представлениями, для получения окончательного HTML ответа.

### Настройка каталога с шаблонами
Чтобы настроить шаблоны в Вашем Django приложении, нужно создать два каталога, в которых будут хранится временные файлы.

В каталоге Вашего Django проекта (например, `<workspace>/tango_with_django_project/`), создайте новый каталог `templates`. Помните, что `<workspace>/tango_with_django_project/` - это каталог, в котором находится скрипт `manage.py`! Внутри нового каталога `templates`, создайте другой каталог с названием `rango`. Таким образом путь `<workspace>/tango_with_django_project/templates/rango/` будет использоваться для хранения шаблонов, связанных с нашим приложением `rango`.

> ### Всегда структурируйте свои шаблоны
> Хорошей практикой является разделение шаблонов, так, чтобы шаблоны для каждого используемого приложения находились в отдельном каталоге. Поэтому мы создали каталог `rango` внутри нашего каталога `templates`. Если Вы захотите создать пакет из Вашего приложения для передачи другим разработчикам, гораздо проще будет понять какие шаблоны принадлежат этому приложению!

Чтобы сообщить Вашему Django проекту, где будут находится шаблоны, откройте файл `settings.py` проекта. Затем найдите в нём структуру данных `TEMPLATES`. По умолчанию, когда Вы создаёте новый Django проект, она будет выглядеть следующим образом.

{lang="python",linenos=off}

	TEMPLATES = [
	    {
	        'BACKEND': 'django.template.backends.django.DjangoTemplates',
	        'DIRS': [],
	        'APP_DIRS': True,
	        'OPTIONS': {
	            'context_processors': [
	                'django.template.context_processors.debug',
	                'django.template.context_processors.request',
	                'django.contrib.auth.context_processors.auth',
	                'django.contrib.messages.context_processors.messages',
	            ],
	        },
	    },
	]

Теперь нам нужно сообщить Django где находятся наши шаблоны изменив список `DIRS`, который по умолчанию является пустым. Добавьте в него строку, чтобы он выглядел следующим образом.

{lang="python",linenos=off}

	'DIRS': ['<workspace>/tango_with_django_project/templates']

Учтите, что Вы *должны использовать абсолютные пути* при указании каталога `templates`. Если Вы являетесь частью команды или работаете на разных компьютерах, это может привести к проблеме в будущем. Проблема заключается в различных путях к Вашему каталогу `<workspace>`. Одним из решений будет добавить путь для каждой из различных конфигураций. Например:
	
{lang="python",linenos=off}

	'DIRS': [ '/Users/leifos/templates',
	          '/Users/maxwelld90/templates',
	          '/Users/davidm/templates', ]

	
Тем не менее это связано с рядом проблем. Во-первых, Вы должны будете каждый раз добавлять путь для каждой новой конфигурации. Во-вторых, если Вы запускаете приложение на разных операционных системах, то для указания путей там могут использоваться не прямой, а обратный слэш.

> ### Не используйте жестко заданные пути!
Жестко-заданными путями вымощена дорога в ад. [Жестко-заданные пути](http://en.wikipedia.org/wiki/Hard_coding) - это [антимоделью при проектировании программного обеспечения](http://sourcemaking.com/antipatterns), и они уменьшат [переносимость](http://en.wikipedia.org/wiki/Software_portability) Вашего проекта - т. е., если Вы запустите его на другом компьютере, то он возможно не заработает!

### Динамические пути
Более удачным решением является использование встроенных функций Python для автоматического определения пути к Вашему каталогу `templates`. Таким образом, абсолютный путь может быть получен независимо от того где Вы размещаете код Вашего Django проекта. Это в свою очередь означает, что улучшает *переносимость* Ваш проекта.

В начале Вашего файла `settings.py` находится переменная `BASE_DIR`. В этой переменной хранится путь к каталогу, в котором находится модуль `settings.py` Вашего проекта. Этот путь определеяется, используя специальный атрибут Python `__file__`, который [определяет абслютный путь к Вашему модулю настроек](http://stackoverflow.com/a/9271479). Вызов `os.path.dirname()` затем позволяет получить ссылку на абсолютный путь к каталогу, содержащему модуль `settings.py`. Повторный вызов `os.path.dirname()` удаляет последний каталог в пути, поэтому `BASE_DIR` содержит  `<workspace>/tango_with_django_project/`. Вы можете увидеть этот процесс в действии, если вам интересно, добавив следующие строки в Ваш файл `settings.py`.

{lang="python",linenos=off}
	print(__file__)
	print(os.path.dirname(__file__))
	print(os.path.dirname(os.path.dirname(__file__)))

Имея доступ к значению `BASE_DIR` позволяет Ваш легко ссылаться на другие каталоги Вашего Django проекта. Таким образом, теперь мы можем создать новую переменную `TEMPLATE_DIR`, которая будет ссылаться на Ваш новый каталог `templates`. Мы можем использовать функцию `os.path.join()` для объединения нескольких путей, что приведет к определению переменной как показано в примере ниже.

{lang="python",linenos=off}
	TEMPLATE_DIR = os.path.join(BASE_DIR, 'templates')

Здесь мы используем `os.path.join()` для объединения переменной `BASE_DIR` и строки `'templates'`, что приведет к `<workspace>/tango_with_django_project/templates/`. Это означает, что затем мы можем использовать нашу новую переменную  `TEMPLATE_DIR` для замены жестко заданного пути, который мы прописали ранее в `TEMPLATES`. Обновите значение для ключа `DIRS`, чтобы оно выглядело следующим образом.

{lang="python",linenos=off}
	'DIRS': [TEMPLATE_DIR, ]

> ### Заем была создана переменная `TEMPLATE_DIR`?
> Вы создали новую переменную `TEMPLATE_DIR` в начале вашего файла `settings.py`, чтобы её можно было легко изменить в случае необходимости. Для более сложных Django проектов, список `DIRS` позволяет Вам указать несколько каталогов для шаблонов, но для этой книги достаточно одного, чтобы всё работало.

> ### Объединение путей
> **При объединении или конкатенации системных путей, всегда используйте `os.path.join()`.** Использование  этой встроенной функции гарантирует, что используются правильные слеши в зависимости от Вашей операционной системы. В операционных системах UNIX (или производных от неё), для разделения каталогов используются прямые слеши (`/`), тогда как операционная система Windows использует обратные (`\`). Если Вы вручную добавите слеши в пути, то это может привести к ошибке при попытке запуска Вашего кода на другой операционной системе, что ухудшит переносимость Вашего проекта.

### Добавление шаблона
После настройки Вашего каталога с шаблонами и пути к нему, создайте файл с названием `index.html` и поместите его в каталог `templates/rango/`. В этот новый файл добавьте следующий HTML код.

{lang="html",linenos=off}
	<!DOCTYPE html>
	<html>
	
	    <head>
	        <title>Rango</title>
	    </head>
	
	    <body>
	        <h1>Rango says...</h1>
	        <div>
	            hey there partner! <br /> 
	            <strong>{{ boldmessage }}</strong><br />
	        </div>
	        <div>
	            <a href="/rango/about/">About</a><br />
	        </div>
	    </body>
	
	</html>

Из этого HTML кода должно быть понятно, что будет создаваться простая HTML страница, приветствующая пользователя сообщением *hello world*. Также в коде присутствует некоторый код не характерный для HTML, например, `{{ boldmessage }}`. Это *переменная шаблона Django*. Мы можем задавать значения для этих переменных и они будут заменяться на нужные нам значения при отображении шаблона. Вскоре мы вернемся к этому.

Чтобы использовать этот шаблон нам необходимо изменить представление `index()`, которое мы создали ранее. Вместо отправки простого сообщения мы изменим его так, чтобы оно отправляло наш шаблон.

Убедитесь, что следующая команда импорта находится в верхней части файла `rango/views.py`. Если её нет - добавьте её.

{lang="python",linenos=off}
	from django.shortcuts import render

Затем Вы можете скорректировать функцию-представление index() следующим образом. Ознакомтесь комментарии внутри функции, чтобы понять, что делает каждая строка.

{lang="python",linenos=off}
	def index(request):
	    # Создаем словарь, чтобы передать шаблону в качестве содержимого.
	    # Заметьте, что ключ boldmessage называется так же как и переменная {{ boldmessage }} в шаблоне!
	    context_dict = {'boldmessage': "Crunchy, creamy, cookie, candy, cupcake!"}
	    
	    # Возвращает ответ, полученный с помощью шаблона, который посылается клиенту.
	    # Для упрощения нашей работы мы используем следующую функцию.
	    # Заметьте, что первый параметр - это шаблон, который мы хотим использовать.
	    return render(request, 'rango/index.html', context=context_dict)

Сначала мы создаём словарь из пар ключ-значение, который мы хотим использовать в шаблоне. Затем мы вызываем вспомогательную функцию `render()`. Эта функция принимает в качестве входного аргумента запрос от пользователя `request`, имя файла шаблона и словарь контекста. Функция `render()` принимает эти данные и объединяет их с шаблоном, выдавая законченную HTML страницу, которая возвращается с *HttpResponse*. Затем этот ответ возвращается и отправляется в веб-браузер пользователя.

> ### Что такое контекст шаблона?
> {#section-templates-static-context}
> Когда файл шаблона загружается системой шаблонов Django, создается *контекст шаблона*. Проще говоря, контекст контекст шаблона представляет собой Python словарь, который связывает имена переменных шаблона с Python переменными. В шаблон, который мы создали ранее, была добавлена переменная шаблона `boldmessage`. В нашем обновленном примере представления `index(request)`, строка `Crunchy, creamy, cookie, candy, cupcake!` связана с переменной шаблона `boldmessage`. Таким образом, строка `Crunchy, creamy, cookie, candy, cupcake!` заменяет *любой* экземпляр `{{ boldmessage }}` в шаблоне.

Теперь, когда Вы изменили представление, чтобы оно могло использовать Ваш шаблон, запустите Django сервер для разработки и перейдите по адресу `http://127.0.0.1:8000/rango/`. Вы должны увидеть свой простой HTML-шаблон, [как показано на рисунке ниже](#fig-ch4-first-template).

Если этого не произошло, прочитайте сообщение об ошибке, чтобы понять в чем проблема, и затем тщательно проверьте все изменения, которые Вы сделали. Одной из наиболее распространенных проблем, с которыми сталкиваются люди при использовании шаблонов - это неправильная настройка пути в `settings.py`. Иногда стоит добавить команду `print` в `settings.py`, чтобы просмотреть переменные `BASE_DIR` и `TEMPLATE_DIR` и убедиться, что всё настроено правильно.

Этот пример показывает, как использовать шаблоны в ваших представлениях. Однако мы затронули лишь часть функциональности, предоставляемой движком шаблонов Django. Позднее мы рассмотрим более сложные способы использования шаблонов в этой книге. В то же время, Вы можете узнать больше о [шаблонах из официальной документации Django](https://docs.djangoproject.com/en/2.0/ref/templates/).

{id="fig-ch4-first-template"}
![Это то, что Вы увидите, когда Ваш первый шаблон правильно заработает. Обратите внимание на текст, выделенный жирным - `Crunchy, creamy, cookie, candy, cupcake!` - который определен в представлениии, но отображается в шаблоне.](images/ch4-first-template.png)

## Работа со статическими медиа файлами {#section-templates-static-static}
Несмотря на то, что Вы используете шаблоны, Ваше приложение Rango, если честно, выглядит несколько простовато - в нём мы не использовали никаких стилей или изображений. Мы можем добавить ссылки на другие файлы в нашем HTML-шаблоне, например, на  [*Каскадные таблицы стилей (CSS)*](http://en.wikipedia.org/wiki/Cascading_Style_Sheets), [*JavaScript*](https://en.wikipedia.org/wiki/JavaScript) и изображения, чтобы улучшить внешний вид страницы. Они называются *статическими файлами*, поскольку не генерируются динамически веб сервером; они просто отправляются как есть в веб браузер клиента. В этом разделе показано как настроить Django для передачи статических файлов, а также как добавить изображение в Ваш простой шаблон.

### Настройка каталога со статическими медиа файлами
Для начала Вам нужно настроить каталог, в котором будут храниться статические медиа файлы. В каталоге с Вашим проектом (например, `<workspace>/tango_with_django_project/`), создайте новый каталог `static` и новый каталог `images` внутри `static`. Убедитесь, что новый каталог `static` находится там же, где и каталог `templates`, который Вы создали ранее в этой главе.

Затем поместите изображение в каталог `images`. Как показано ниже, мы выбрали изображение [хамелеона Rango](http://www.imdb.com/title/tt1192628/) - подходящий талисман, если бы он был нужен.

{id="fig-ch4-rango"}
![Хамелеон Ранго в нашем каталоге статических медиа файлов `static/images`.](images/ch4-rango-picture.png)

Как и для ранее созданного каталога `templates`, нам надо сообщить Django о нашем новом каталоге `static`. Для этого нам опять нужно отредактировать наш модуль `settings.py` проекта. В этом файле добавьте новую переменную, указывающую на наш каталог `static`, и структуру данных, которую Django сможет проанализировать, чтобы определить, где находится наш новый каталог.

Прежде всего создайте переменную `STATIC_DIR` в начале файла `settings.py`, желательно под `BASE_DIR` и `TEMPLATES_DIR`, чтобы все наши пути находились в одном и том же месте. Для `STATIC_DIR` мы будем использовать тот же способ с `os.path.join`, который использовали для шаблонов - но в этот раз, используйте каталог `static`, как показано ниже.

{lang="python",linenos=off}
	STATIC_DIR = os.path.join(BASE_DIR, 'static')

Это даст нам абсолютный путь к каталогу `<workspace>/tango_with_django_project/static/`. После создания этой переменной нам необходимо создать новую структуру данных `STATICFILES_DIRS`. Это по сути список путей, используя которые Django будет искать статические файлы. По умолчанию, этого списка не существует - **проверьте** это перед его созданием. Если Вы определите его дважды, то это приведет к ошибкам в Django.

Для этой кинги, мы будем использовать только один каталог для хранения статических файлов нашего проекта - путь, указанный в `STATIC_DIR`. Таким образом, мы можем просто настроить `STATICFILES_DIRS` следующим образом.

{lang="python",linenos=off}
	STATICFILES_DIRS = [STATIC_DIR, ]

> ### Не захламляйте `settings.py`!
> В Ваших интересах не захламлять Ваш модщуль `settings.py` и придерживайтесь опредлеенной организации в файле. Не создавайте переменные просто в случайных местах; используйте существующую организацию. Располагайте Ваши переменные `DIRS` в верхней части моделя, чтобы их было легко найти и помесите `STATICFILES_DIRS` в часть модуля, которая отвечает за статические медиа файлы (находится ближе к концу файла). Когда Вам нужно будет отредактировать файл позднее, Вам или другим сотрудникам будет проще найти необходимые переменные.

Наконец убедитесь, что переменная `STATIC_URL` определена в Вашем модуле `settings.py`. Если нет, то определите её как показано ниже. Обратите внимание, что эта переменная по умолчанию в Django определена ближе к концу модуля, поэтому возможно вам потребуется воспользоваться скролом, чтобы найти её.

{lang="python",linenos=off}
	STATIC_URL = '/static/'

Вы добавили несколько переменных, но для чего они нужны? Проще говоря, первые две переменные `STATIC_DIR` и `STATICFILES_DIRS` указывают на то, где хранятся статические файлы на Вашем компьютере. Последняя переменная `STATIC_URL` позволяет нам указать URL-адрес, с помощью которого можно получить доступ к статическим файлам при запуске нашего Django сервера для разработки. Например, если `STATIC_URL` равно `/static/`, мы можем получить доступ к статическому содержимому по адресу `http://127.0.0.1:8000/static/`. *Считайте, что первые две переменные определяют местоположение файлов на сервере, а третья переменная - путь с помощью которого клиенты могут получить доступ к статическому содержимому.*

> ### Проверьте Вашу конфигурацию
> В качестве небольшого упражнения проверьте всё ли работает правильно. Попытайтесь просмотреть изображение `rango.jpg` в Вашем браузере, когда запущен Django сервер для разработки.
> Если Ваш `STATIC_URL` равен `/static/` и `rango.jpg` можно найти по адресу `images/rango.jpg`, какой URL-адрес Вы введёте в адресной строке своего браузера?
>
> **Попытайтесь самостоятельно определить его прежде чем мы продолжим! Если у Вас не получится, то ответ приведен ниже.**

> ### Не забывайте о слешах!
> При настройке `STATIC_URL`, проверьте, что указанный вами URL-адрес заканчивается прямым слешом (например, `/static/`, а не `/static`). Согласно [официальной документации Django](https://docs.djangoproject.com/en/1.9/ref/settings/#std:setting-STATIC_URL), если этого не сделать, то это приведет к куче проблем. Дополнительный слеш в конце гарантирует, что корень URL-адреса (например, `/static/`) отделен от статического содержимого, которое Вы хотите отдавать (например, `images/rango.jpg`).

> ### Отдача статического содержимого
> Хотя можно использовать сервер для разработки Django для разрачи Ваших статических файлов при разработке приложения, его нельзя использовать при реальной работе приложения. В [Django документации по развертыванию](https://docs.djangoproject.com/en/2.0/howto/static-files/deployment/) дается дополнительная информация о развертывании статических файлов на сервере, где приложение будет работать. Мы вернемся к этой проблема и рассмотрим её подробнее, когда будем [развертывать Rango](#chapter-deploy).

Если Вы не смогли определить по какому адресу будет доступно изображение, перейдите в Вашем браузере по адресу `http://127.0.0.1:8000/static/images/rango.jpg`.

### Статические медиа файлы и шаблоны
Теперь, когда Ваш Django проект настроен и может работать со статическими медиа файлами, Вы можете получить доступ к ним из шаблонов, чтобы улучшить их внешний вид и добавить функциональности.

Чтобы показать, как добавить статические медиа файлы, откройте шаблон `index.html`, созданный Вами ранее, расположенный в каталоге `<workspace>/templates/rango/`. Измените исходный HTML код следующим образом. Две новые строки добавлены с HTML комментарием, чтобы их было легче найти.

{lang="html",linenos=off}
	<!DOCTYPE html>
	
	{% load staticfiles %} <!-- Новая строка -->
	
	<html>
	    <head>
	        <title>Rango</title>
	    </head>
	    
	    <body>
	        <h1>Rango says...</h1>
	        
	        <div>
	            hey there partner! <br />
	            <strong>{{ boldmessage }}</strong><br />
	        </div>
	        
	        <div>
	            <a href="/rango/about/">About</a><br />
	            <img src="{% static "images/rango.jpg" %}"
	                 alt="Picture of Rango" /> <!-- Новая строка -->
	        </div>
	    </body>
	    
	</html>

Первая новая добавленная строка (`{% load staticfiles %}`) сообщает движку шаблонов Django, что мы использовать статические медиа файлы в шаблоне. Это в свою очередь позволяет нам получить доступ к файлам в каталогах со статическим содержимым с помощью тега `static` [тег шаблона](https://docs.djangoproject.com/en/2.0/ref/templates/builtins/). Он сообщает Django, что мы хотим показать изображение раасположенное в каталоге со статическим содержимым под названием `images/rango.jpg`. Теги шаблонов заключены в фигурным скобки (например, `{%  %}`), а использование `static` объединит URL-адрес, указанный в `STATIC_URL` с `images/rango.jpg`, что приведет к `/static/images/rango.jpg`. HTML, созданный движком шаблонов Django будет выглядеть следующим образом:

{lang="html",linenos=off}
	<img src="/static/images/rango.jpg" alt="Picture of Rango" /> 

Если по какой-то причине изображение не может быть загружено, всегда рекомендуется указывать для него альтернативный текст. Для этого используется атрибут ``alt`` внутри тега `img`. Вы можете увидеть что произойдет в этом случает на [скриншоте, показанном ниже](#fig-ch4-rango-site-with-alt-text).

{id="fig-ch4-rango-site-with-alt-text"}
![Изображение Rango не было найдено и вместо этого было заменено на текст из атрибута `alt` тега `img`.](images/ch4-rango-site-with-alt-text.png)

После внесения этих незначительых изменений запустите сервер для разработки Django ещё раз и перейдите по адресу `http://127.0.0.1:8000/rango`. Если всё сделано правильно, то вы увидите страницу, похожую на [снимок экрана, показанный ниже](#fig-ch4-rango-site-with-pic).

{id="fig-ch4-rango-site-with-pic"}
![Наш первый Rango шаблон с изображением хамелеона Rango.](images/ch4-rango-site-with-pic.png)

> ### Шаблоны и `<!DOCTYPE>`
> При создании HTML шаблонов всегда следите, чтобы [объявление `DOCTYPE`](http://www.w3schools.com/tags/tag_doctype.asp) было в **первой строке**. Если сначала поместить команду `{% load staticfiles %}`, к отображаемому шаблону будет добавлена пустая строка или пробел перед объявлением `DOCTYPE`. Эта пустая строка или пробел приведет к тому что Ваша HTML разметка [не пройдет валидацию](https://validator.w3.org/).

> ### Загрузка других статических файлов
> Тег шаблона ``{% static %}`` можно использовать всякий раз, когда Вы хотите сослаться на статические файлы в шаблоне. Пример кода ниже показывает как Вы можете добавить JavaScript, CSS и изображения в Ваши шаблоны с правильной HTML разметкой.
>
> {lang="html",linenos=off}
> 	<!DOCTYPE html>
> 	{% load staticfiles %}
> 	
> 	<html>
> 	    
> 	    <head>
> 	        <title>Rango</title>
> 	        <!-- CSS -->
> 	        <link rel="stylesheet" href="{% static "css/base.css" %}" />
> 	        <!-- JavaScript -->
> 	        <script src="{% static "js/jquery.js" %}"></script>
> 	    </head>
> 	
> 	    <body>
> 	        <!-- Изображение -->
> 	        <img src="{% static "images/rango.jpg" %}" alt="A chameleon lizard called Rango"  />
> 	    </body>
> 	
> 	</html>
>
> Очевидно, что статические файлы, на которые Вы ссылаетесь, должны находиться в Вашем каталоге `static`. Если файл находится не там или Вы не правильно на него сослались, то в командной строке сервер для разработки Django's выведет [ошибку `HTTP 404`](https://en.wikipedia.org/wiki/HTTP_404). Попытайтесь сослаться на не существующий файл и посмотрите что произойдет. Посмотрите на фрагмент командной строки приведенной ниже и обратите внимание, что HTTP код состояния в последней строке равен `404`.
>
> {lang="text",linenos=off}
> 	[10/Apr/2016 15:12:48] "GET /rango/ HTTP/1.1" 200 374
> 	[10/Apr/2016 15:12:48] "GET /static/images/rango.jpg HTTP/1.1" 304 0
> 	[10/Apr/2016 15:12:52] "GET /static/images/not-here.jpg HTTP/1.1" 404 0
>
> Для получения дополнительной информации о добавлении статических файлов прочтите официальную [Django документацию по работе со статическими файлами в шаблонах](https://docs.djangoproject.com/en/2.0/howto/static-files/#staticfiles-in-templates).

## Работа с медиа файлами {#section-templates-upload}
Статическими медиа файлами можно считать файлы, которые не меняются и являются ключевыми для работы Вашего приложения. Однако часто Вам придется хранить *медиа файлы*, которые по своей природе являются динамическими. Эти файлы могут быть загружены Вашими пользователями или администраторами и поэтому могут измениться. Примером такого медиа файла может быть изображение являющееся аватаром пользователя. Если Вы запускаете сайт для онлайн продаж, то медиа файлами могут быть изображения различных товаров, которые есть в Вашем интернет-магазине.

Чтобы работать с такими медиа файлами нам необходимо обновить настройки проекта Django. В этом разделе подробно описывается что Вам нужно добавить - [но мы протестируем правильность этих настроек позднее](#chapter-ex), когда реализуем функцию, позволяющую пользователям загружать изображение для аватара в профиль.

> ### Раздача медиа файлов
> Как и при раздаче статического контента, Django предоставляет возможность раздавать медиа файлы в Вашем окружении для разработки - чтобы убедиться, что всё работает правильно. Методы, которые Django использует для раздачи этого контента, неподходят для реального рабочего окружения, поэтому Вам необходимо продумать другой способ раздачи медиа файлов Вашего приложения. В [главе, посвященной развертыванию](#chapter-deploy) мы обсудим эту проблему более подробно.

### Модифицируем `settings.py`
Сначала откройте модуль `settings.py` Вашего Django проекта. Сюда мы добавим ещё несколько элементов. Как и статические файлы, медиа файлы загружаются в оппределенный каталог Вашей файловой системы. Нам необходимо указать Django, где хранить эти файлы.

В верхей части Вашего модуля `settings.py`, найдите существующие переменные `BASE_DIR`, `TEMPLATE_DIR` и `STATIC_DIR` - они должны быть раасположены в начале файла. Под ними добавьте ещё одну переменную `MEDIA_DIR`.

{lang="python",linenos=off}
	MEDIA_DIR = os.path.join(BASE_DIR, 'media')

Эта строка укажет Django, что медиа файлы будут загружены в корень Вашего Django проекта плюс '/media' - или `<workspace>/tango_with_django_project/media/`. Как мы уже упоминали, хранение этих переменных пути в начале Вашего модуля `settings.py` позволяет Вам легко изменить пути позднее при необходимости.

Теперь найдите свободное место в `settings.py` и добавьте ещё две переменные. Переменные `MEDIA_ROOT` и `MEDIA_URL` будут [использоваться Django для настройки хостинга медиа файлов](https://docs.djangoproject.com/en/2.0/howto/static-files/#serving-files-uploaded-by-a-user-during-development).

{lang="python",linenos=off}
	MEDIA_ROOT = MEDIA_DIR
	MEDIA_URL = '/media/'

> ### Напомним ещё раз - не забывайте о слешах!
>
> Как и для переменной `STATIC_URL` уведитесь, что `MEDIA_URL` заканчивается прямым слешом (т. е. `/media/`, а не `/media`). Дополнительный слеш в конце гаранитирует, что корень URL (например, `/media/`) отделен от содержимого загружаемого пользователями Вашего приложения.

Эти две переменные сообщают Django где искать загруженные/сохраненные медиа файлы в Вашей файловой системе (`MEDIA_ROOT`), и с какого URL их следует раздавать (`MEDIA_URL`). Для используемой выше конфигурации, загруженный файл `cat.jpg` будет доступен на Вашем сервере для разработки Django по адресу `http://localhost:8000/media/cat.jpg`. 

Когда мы начнём работать с шаблонами [в дальнейшем](#chapter-mtv), было бы удобно получать ссылку на путь `MEDIA_URL` в случаях, когда нам нужно будет сослаться на загружаемый контент. Django предоставляет [*шаблонный контекстный процессор*](https://docs.djangoproject.com/en/2.0/ref/templates/api/#django-template-context-processors-media), который облегчит нам выполнение этой задачи. Хотя эта настройка не нужна нам прямо сейчас, самое время добавить её.

Для этого найдите список `TEMPLATES` в `settings.py`. В этом списке найдите вложенный список `context_processors` и в этом списке добавьте новый обработчик `django.template.context_processors.media`. Ваш список `context_processors` должен выглядеть примерно следующим образом после этого.

{lang="python",linenos=off}
	'context_processors': [
	    'django.template.context_processors.debug',
	    'django.template.context_processors.request',
	    'django.contrib.auth.context_processors.auth',
	    'django.contrib.messages.context_processors.messages',
	    'django.template.context_processors.media'
	],

### Настройка Ваших URLs
Последний шаг в настройке раздачи медиа в окружении для разработки - это указание Django, что нужно раздавать статические файлы из `MEDIA_URL`. Это можно сделать открыв модуль `urls.py` Вашего проекта и изменив его добаив вызов функции `static()` в список `urlpatterns` Вашего проекта.

{lang="python",linenos=off}
	urlpatterns = [
	    ...
	    ...
	] + static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)

Вам также необходимо добавить следующие команды `import` в начало модуля `urls.py`.

{lang="python",linenos=off}
	from django.conf import settings
	from django.conf.urls.static import static

После этого Вы сможете получать содержимое каталога `media` Вашего проекта, используя `/media/` URL.

## Основная последовательность действий
Прочитав эту главу, Вы должны знать как настраивать и создавать шаблоны, использовать шаблоны в Ваших представлениях, настраивать и использовать сервер для разработки Django для отправки статических медиа файлов *и* как добюавлять изображения в Ваши шаблоны. Мы действительно рассмотрели столько тем!

Процесс создания шаблона и его интеграция в Django представление - это основная идея, которая должна быть Вам понятна. Он выполняется в несколько шагов, но после нескольких попыток это войдет в привычку.

1. Во-первых, создайте шаблон, который Вы хотите использовать и сохраните его в каталоге `templates` который Вы указали в модуле `settings.py` Вашего проекта. Вы можете использовать переменные шаблона Django (например, `{{ variable_name }}`) или [теги шаблона](https://docs.djangoproject.com/en/2.0/ref/templates/builtins/) в Вашем шаблоне. Вы сможете заменить их на что угодно в соответствующем представлении.
2. Найдите или создайте новое представление в файле приложения `views.py`.
3. Добавьте свою логику в представление (если она необходима). Например, извлечение данных из базы данных и сохранение их в списке.
4. В представлении создайте словарь, который Вы передадите механизму шаблонов в качестве [*контекста* шаблона](#section-templates-static-context).
5. Воспользуйтесь вспомогательной функцией  `render()` для создания ответа на основе шаблона. Убедитесь, что Вы передаете функции запрос, затем файл шаблона и наконец словарь контекста.
6. Если Вы ещё этого не сделали, то сопоставьте представлению URL, модифицируя файл Вашего проекта `urls.py` и файл `urls.py` приложения, если он существует.

Шаги, необходимые для добавления статического медиа файла на одну из Ваших страниц, являются частью другого важного процесса, с которым Вы должны быть знакомы. Ниже приведен пошаговый процесс как это сделать.

1. Выберите статический медиа файл, который Вы хотите использовать, и поместите его в каталог `static` Вашего проекта. Это каталог, который Вы определяете в списке `STATICFILES_DIRS` `settings.py`.
2. Добавьте ссылку на статический медиа файл в шаблоне. Например, изображение должно быть вставлено в HTML страницу с помощью тега <img />. 
3. Не забудьте использовать команды {% load staticfiles %} и {% static "filename" %} в шаблоне для доступа к статическим файлам. Замените `<filename>` на путь к изображению или ресурсу, на который Вы хотите сослаться. **Когда Вы хотите сослаться на статический файл, используйте тег шаблона `static`!**

Шаги, необходимые для раздачи медиа файлов подобны тем, которые нужно осуществить для раздачи статических файлов.

1. Поместите файл в каталог `media` Вашего проекта. Каталог `media` задается в переменной `MEDIA_ROOT` Вашего проекта.
2. Чтобы сослаться на медиа файл в шаблоне используйте переменую контекста `{{ MEDIA_URL }}`. Например, чтобы сослаться на загруженное изображение `cat.jpg` используйте тег `<img />` следующим образом `<img src="{{ MEDIA_URL}}cat.jpg" />`.

> ### Упражнения
>
> Выполните следующие упражнения, чтобы закрепить то, что Вы узнали из этой главы.
> 
> * Измените страницу about так, чтобы она тоже использовала шаблон под названием `about.html`.
> * В этот новый шаблон `about.html`, добавьте изображение сохраненное в каталоге статических медиа файлов Вашего проекта.
> * На странице about добавьте строку `This tutorial has been put together by <your-name>`.
> * В Вашем каталоге Django проекта, создайте новый каталог `media`, загрузите изображение кота и сохраните его в каталоге `media` как `cat.jpg`.
> * На Вашей **странице about**, добавьте тег `<img>` для отображения изображения кошки, чтобы проверить правильную отдачу медиафайлов. Оставьте статическое изображение Rango на Вашей главной странице, чтобы в Вашем приложении были рабочие примеры отдачи статических и медиа файлов.

> ### Статические и медиа файлы
> Запомните: статические файлы, как следует из названия, не меняются. Эти файлы являются основными компонентами Вашего сайта. Медиа-файлы определяются пользователем; и как следствие могут часто меняться!
>
> Примером статического файла может быть файл стилей (css), который определяет внешний вид Вашего приложения. примером медиа-файла может быть изображение аватара пользователя, которое загружается пользователем при создании учетной записи в Вашем приложении.

> ### Тесты
>
> Мы написали несколько тестов, чтобы проверить правильно ли Вы выполнили упражнения. Чтобы проверить свою работу, [загрузите скрипт `tests.py`](https://github.com/leifos/tango_with_django_2/blob/master/code/tango_with_django_project/rango/tests.py) из нашего [GitHub репозитория](https://github.com/leifos/tango_with_django_2/), и сохраните его в каталоге приложения `rango`.
>
> Рекомендуется писать тесты, чтобы убедиться, что приложение работает должным образом.
> Чтобы запустить тесты, введите следующую команду в терминале или командной строке.
>
> {lang="text",linenos=off}
>     $ python manage.py test rango
>
> Если Вас заинтересовали возможности автоматизированного тестирования, сейчас самое время просмотреть [главу, посвященную тестированию](#chapter-testing). В этой главе рассматриваются некоторые основные принципы написания тестов для автоматической проверки целостности вашего кода.
>
> На данный момент Вы можете увидеть прошли ли тесты успешно или нет. Если нет, то посмотрите какие тесты не были пройдены, откройте свой код и обновите его так, чтобы он соответствовал требованиям теста.

